<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rumwell Online Statistics</title>
    <style>
        body {
            zoom: 0.5;
            font-family: Arial, sans-serif;
            background-color: #f9f9f9;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: #fff;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        h1 {
            font-size: 24px;
            margin-bottom: 10px;
        }

        .statistics,
        .revenue-liabilities,
        .incomes {
            margin-bottom: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        table,
        th,
        td {
            border: 1px solid #ddd;
        }

        th,
        td { 
font-size: 9px;
            padding: 10px;
            text-align: center;
        }

        th {
            background-color: #4CAF50;
            color: white;
        }

        .total {
            text-align: right;
        }

        .section-title {
            font-size: 18px;
            margin-bottom: 10px;
        }

        .add-item-btn {
            padding: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            text-align: center;
        }

        .add-item-btn:hover {
            background-color: #45a049;
        }

        .date-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .date-navigation button {
            padding: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }

        .date-navigation button:hover {
            background-color: #45a049;
        }

        .date-navigation input {
            font-size: 18px;
            padding: 5px;
            text-align: center;
        }

        .revenue-liabilities h3,
        .incomes h3 {
            margin-top: 20px;
        }

        .revenue-liabilities div,
        .incomes div {
            margin-bottom: 10px;
        }

.turnover-container {
    margin-top: 20px;
    padding: 10px;
    background-color: #f1f1f1;
    border: 1px solid #ddd;
    border-radius: 5px;
}
.u{
padding: 30px;
background-color: #f1f1f1;
border-radius: 20px;
text-align: top;
 }
.hi{
display: flex;
flex-wrap: wrap;
justify-content: space-between;
}
h4{
padding:0px;
}

.revenue-liabilities{
border-bottom: 4px solid black;
border-top: 4px solid black;
padding-top: 20px;
padding-bottom: 20px;
}
.incomes{
padding-top: 20px;
border-bottom: 4px solid black;
padding-bottom: 20px;
}
.highlight {
            background-color: #EBE6E0;
    </style>
</head>

<body>
    <div class="container">
        <h1>Rumwell Online</h1>

        <div class="date-navigation">
    <button onclick="prevDate()">â—€ï¸Ž Prev</button>
    <input type="text" id="currentDate" value="2024-10-14" readonly>
    <button onclick="nextDate()">Next â–¶ï¸Ž</button>
    <button id="shareBtn" style="float: right;" onclick="shareTable()">ðŸ“¨share</button>
</div>


        <div class="statistics">
            <h2 class="section-title">Statistics</h2>
<input type="text" id="searchInput" placeholder="Search for an item..." oninput="searchItem()">
            <table id="statisticsTable">
                <thead>
                    <tr>
                        <th>Item</th>
                        <th>Opening Stock</th>
                        <th>Orders</th>
                        <th>Total Stock</th>
                        <th>Closing Stock</th>
                        <th>Sales</th>
                        <th>Price</th>
                        <th>Total</th>
                    </tr>
                </thead>
                <tbody></tbody>
                <tfoot>

                    <tr>
<td>  <button class="add-item-btn" onclick="addItem()" style="float: left;">+ Add</button></td>
                        <td 
                          
class="total" colspan="6"><strong >TOTAL:</strong></td>
                        <td id="totalAmount"><strong>K0.00</strong></td>
                    </tr>
                   
                </tfoot>
            </table>
        </div>

        <div class="revenue-liabilities">
            <h2>Revenue Liabilities</h2>
<div class="hi">
            <div class="u" id="expenses">
                <h4>Expenses</h4>
<button onclick="addRevenueLiability('expenses')">+ Add</button>
            </div>
                
            <div class="u"  id="debtors">
                <h4>Debtors</h4>
                <button onclick="addRevenueLiability('debtors')">+ Add</button>
            </div>
            <div class="u"  id="drawings">
                <h4>Drawings</h4>
                <button onclick="addRevenueLiability('drawings')">+ Add</button>
            </div>
            <div class="u" id="creditPayments">
                <h4>Credit Payments</h4>
                <button onclick="addRevenueLiability('creditPayments')">+ Add</button>
            </div>
        </div>
</div>
        <div class="incomes">
            <h2>Incomes</h2>
<div class="hi">
            <div class="u" id="credit">
                <h4>Credit</h4>
                <button onclick="addIncome('credit')">+ Add</button>
            </div>
            <div class="u" id="ownersDeposit">
                <h4>Owners Deposit</h4>
                <button onclick="addIncome('ownersDeposit')">+ Add</button>
            </div>
            <div class="u" id="debtorPayments">
                <h4>Debtor Payments</h4>
                <button onclick="addIncome('debtorPayments')">+ Add</button>
            </div>
        </div>
    </div>
</div>

<div class="turnover-container">
    <h2 class="section-title">Turnover</h2>
    <div>Total Revenue Liabilities: <span id="totalRevenueLiabilities">K0.00</span></div>
    <div>Total Incomes: <span id="totalIncomes">K0.00</span></div>
    <div>Net Sales: <span id="netSales">K0.00</span></div>
    <div>Net Purchases: <span id="netPurchases">K0.00</span></div>
    <div>Gross Profit: <span id="grossProfit">K0.00</span></div>
    <div>Net Profit: <span id="netProfit">K0.00</span></div>
</div>

<script>
    function shareTable() {
        // Get all rows from the table
        const table = document.getElementById('statisticsTable').getElementsByTagName('tbody')[0];
        const rows = table.getElementsByTagName('tr');
        let tableData = 'Statistics Table:\n';

        // Loop through rows and get the data
        for (let i = 0; i < rows.length; i++) {
            const cells = rows[i].getElementsByTagName('td');
            const rowData = `${cells[0].innerText} - Opening: ${cells[1].innerText}, Orders: ${cells[2].innerText}, Closing: ${cells[4].innerText}, Price: ${cells[6].innerText}, Total: ${cells[7].innerText}\n`;
            tableData += rowData;
        }

        // Append the total amount
        const total = document.getElementById('totalAmount').innerText;
        tableData += `\nTOTAL: ${total}\n`;

        // Get revenue liabilities and incomes data
        const revenueLiabilities = document.getElementById('totalRevenueLiabilities').innerText;
        const incomes = document.getElementById('totalIncomes').innerText;
        const netSales = document.getElementById('netSales').innerText;
        const netPurchases = document.getElementById('netPurchases').innerText;
        const grossProfit = document.getElementById('grossProfit').innerText;
        const netProfit = document.getElementById('netProfit').innerText;

        // Append revenue liabilities and incomes to the message
        tableData += `\nRevenue and Incomes:\n`;
        tableData += `Total Revenue Liabilities: ${revenueLiabilities}\n`;
        tableData += `Total Incomes: ${incomes}\n`;
        tableData += `Net Sales: ${netSales}\n`;
        tableData += `Net Purchases: ${netPurchases}\n`;
        tableData += `Gross Profit: ${grossProfit}\n`;
        tableData += `Net Profit: ${netProfit}\n`;

        // Encode the data for WhatsApp
        const encodedData = encodeURIComponent(tableData);

        // Generate the WhatsApp share link
        const whatsappUrl = `https://wa.me/?text=${encodedData}`;
        window.open(whatsappUrl, '_blank');
    }



 const LOCAL_STORAGE_KEY = 'rumwel-stats';
let longPressTimer;  // Timer for detecting long press

// Get current date
// Get current date in YYYY-MM-DD format
let currentDate = new Date().toISOString().split('T')[0];

// Load initial data from localStorage
loadDateData(currentDate);

// Function to navigate to previous date
function prevDate() {
    const date = new Date(currentDate);
    date.setDate(date.getDate() - 1);
    const formattedDate = date.toISOString().split('T')[0];
    loadDateData(formattedDate);
}

// Function to navigate to next date
function nextDate() {
    const date = new Date(currentDate);
    date.setDate(date.getDate() + 1);
    const formattedDate = date.toISOString().split('T')[0];
    loadDateData(formattedDate);
}

// Function to load data for a specific date
function loadDateData(date) {
    // Set current date
    currentDate = date;
    document.getElementById('currentDate').value = currentDate;

    // Get data for the current date from localStorage
    let dateData = getStoredData(currentDate);

    // Clear table rows
    const tbody = document.getElementById('statisticsTable').getElementsByTagName('tbody')[0];
    tbody.innerHTML = "";

    // Add rows based on date data
    dateData.forEach(itemData => {
        addItemRow(itemData);
    });

    // Update total sum of all rows
    updateTotalAmount();

    // Render liabilities and incomes for the selected date
    renderLiabilities(currentDate);
    renderIncomes(currentDate);

    // Update turnover calculations
    calculateTurnover();
}



// Function to add a new item
function addItem() {
    const table = document.getElementById('statisticsTable').getElementsByTagName('tbody')[0];
    const newRow = table.insertRow();

    const itemCell = newRow.insertCell(0);
    const openingStockCell = newRow.insertCell(1);
    const ordersCell = newRow.insertCell(2);
    const totalStockCell = newRow.insertCell(3);
    const closingStockCell = newRow.insertCell(4);
    const salesCell = newRow.insertCell(5);
    const priceCell = newRow.insertCell(6);
    const totalCell = newRow.insertCell(7);

    itemCell.contentEditable = true;
    openingStockCell.contentEditable = true;
    ordersCell.contentEditable = true;
    closingStockCell.contentEditable = true;
    priceCell.contentEditable = true;

    totalStockCell.innerHTML = "0";
    salesCell.innerHTML = "0";
    totalCell.innerHTML = "0.00";

    // Add event listeners to update fields automatically
    openingStockCell.addEventListener("input", calculateRow);
    ordersCell.addEventListener("input", calculateRow);
    closingStockCell.addEventListener("input", calculateRow);
    priceCell.addEventListener("input", calculateRow);

    // Add long press detection for removing items
    itemCell.addEventListener('mousedown', () => startLongPress(newRow));
    itemCell.addEventListener('mouseup', cancelLongPress);
    itemCell.addEventListener('mouseleave', cancelLongPress);
    itemCell.addEventListener('touchstart', () => startLongPress(newRow));
    itemCell.addEventListener('touchend', cancelLongPress);

    // Immediately save the new item to localStorage
    newRow.addEventListener("input", () => {
        saveCurrentDateData();
    });

    saveCurrentDateData();
}

// Function to start the long press timer
function startLongPress(row) {
    longPressTimer = setTimeout(() => {
        if (confirm("Do you want to remove this item?")) {
            row.remove();  // Remove the item from the table
            saveCurrentDateData();  // Save changes to localStorage
        }
    }, 2000);  // Long press duration: 2000ms (2 seconds)
}

// Function to cancel the long press
function cancelLongPress() {
    clearTimeout(longPressTimer);
}

// Function to add item row
function addItemRow(itemData) {
    const tbody = document.getElementById('statisticsTable').getElementsByTagName('tbody')[0];
    const newRow = tbody.insertRow();

    const itemCell = newRow.insertCell(0);
    const openingStockCell = newRow.insertCell(1);
    const ordersCell = newRow.insertCell(2);
    const totalStockCell = newRow.insertCell(3);
    const closingStockCell = newRow.insertCell(4);
    const salesCell = newRow.insertCell(5);
    const priceCell = newRow.insertCell(6);
    const totalCell = newRow.insertCell(7);

    itemCell.innerText = itemData.item;
    openingStockCell.innerText = itemData.openingStock;
    ordersCell.contentEditable = true;
    closingStockCell.contentEditable = true;
    priceCell.contentEditable = true;
    ordersCell.innerText = itemData.orders;
    closingStockCell.innerText = itemData.closingStock;
    priceCell.innerText = itemData.price.toFixed(2);

    // Initial calculations
    const totalStock = itemData.openingStock + itemData.orders;
    totalStockCell.innerText = totalStock;

    const sales = totalStock - itemData.closingStock;
    salesCell.innerText = sales;

    const total = sales * itemData.price;
    totalCell.innerText = total.toFixed(2);

    // Add event listeners for editable cells
    ordersCell.addEventListener("input", () => calculateRow(newRow));
    closingStockCell.addEventListener("input", () => calculateRow(newRow));
    priceCell.addEventListener("input", () => calculateRow(newRow));

    // Add long press detection for removing items
    itemCell.addEventListener('mousedown', () => startLongPress(newRow));
    itemCell.addEventListener('mouseup', cancelLongPress);
    itemCell.addEventListener('mouseleave', cancelLongPress);
    itemCell.addEventListener('touchstart', () => startLongPress(newRow));
    itemCell.addEventListener('touchend', cancelLongPress);

    // Immediately save the item row when modified
    newRow.addEventListener("input", () => saveCurrentDateData());
}

// Function to calculate row data
function calculateRow(row) {
    const openingStock = parseFloat(row.cells[1].innerText) || 0;
    const orders = parseFloat(row.cells[2].innerText) || 0;
    const closingStock = parseFloat(row.cells[4].innerText) || 0;
    const price = parseFloat(row.cells[6].innerText) || 0;

    const totalStock = openingStock + orders;
    row.cells[3].innerText = totalStock;

    const sales = totalStock - closingStock;
    row.cells[5].innerText = sales;

    const total = sales * price;
    row.cells[7].innerText = total.toFixed(2);

    // Save current date's data to localStorage
    saveCurrentDateData();

    // Automatically add to next date if closing stock is added
    if (closingStock) {
        addToNextDate(row.cells[0].innerText, closingStock, price);
    }

    // Update total sum of all rows
    updateTotalAmount();

    // Update turnover calculations
    updateTurnover();
}

// Function to update total sum
function updateTotalAmount() {
    const table = document.getElementById('statisticsTable').getElementsByTagName('tbody')[0];
    const rows = table.rows;
    let totalAmount = 0;

    for (let i = 0; i < rows.length; i++) {
        const rowTotal = parseFloat(rows[i].cells[7].innerText) || 0;
        totalAmount += rowTotal;
    }

    document.getElementById('totalAmount').innerText = "K" + totalAmount.toFixed(2);

    // Update turnover calculations
    updateTurnover();
}

// Function to add item to next date
function addToNextDate(item, closingStock, price) {
    const date = new Date(currentDate);
    date.setDate(date.getDate() + 1);
    const nextDate = date.toISOString().split('T')[0];

    let nextDateData = getStoredData(nextDate);

    const existingItem = nextDateData.find(data => data.item === item);
    if (existingItem) {
        existingItem.openingStock = closingStock;
    } else {
        nextDateData.push({
            item: item,
            openingStock: closingStock,
            orders: 0,
            closingStock: 0,
            price: price
        });
    }

    saveData(nextDate, nextDateData);
}

// Function to save current date's data
function saveCurrentDateData() {
    const table = document.getElementById('statisticsTable').getElementsByTagName('tbody')[0];
    const rows = table.rows;
    const data = [];

    for (let i = 0; i < rows.length; i++) {
        const item = rows[i].cells[0].innerText;
        const openingStock = parseFloat(rows[i].cells[1].innerText) || 0;
        const orders = parseFloat(rows[i].cells[2].innerText) || 0;
        const closingStock = parseFloat(rows[i].cells[4].innerText) || 0;
        const price = parseFloat(rows[i].cells[6].innerText) || 0;

        data.push({
            item: item,
            openingStock: openingStock,
            orders: orders,
            closingStock: closingStock,
            price: price
        });
    }

    saveData(currentDate, data);
}

// Function to save data to localStorage
function saveData(date, data) {
    localStorage.setItem(LOCAL_STORAGE_KEY + "-" + date, JSON.stringify(data));
}

// Function to get stored data for a specific date
function getStoredData(date) {
    const storedData = localStorage.getItem(LOCAL_STORAGE_KEY + "-" + date);
    return storedData ? JSON.parse(storedData) : [];
}

// Function to add a new liability
function addRevenueLiability(type) {
    const name = prompt("Enter the name of the liability:");
    const amount = parseFloat(prompt("Enter the amount of the liability:")) || 0;

    if (name) {
        const liability = { name, amount, type };
        saveLiability(currentDate, liability);
        
        // Re-render liabilities and recalculate turnover
        renderLiabilities(currentDate);
        calculateTurnover();  // Update turnover
    }
}

// Function to add a new income
function addIncome(type) {
    const name = prompt("Enter the name of the income:");
    const amount = parseFloat(prompt("Enter the amount of the income:")) || 0;

    if (name) {
        const income = { name, amount, type };
        saveIncome(currentDate, income);
        
        // Re-render incomes and recalculate turnover
        renderIncomes(currentDate);
        calculateTurnover();  // Update turnover
    }
}


// Save liability to localStorage
function saveLiability(date, liability) {
    const data = getStoredDataForDate(date, 'liabilities') || [];
    data.push(liability);
    localStorage.setItem(LOCAL_STORAGE_KEY + "-" + date + "-liabilities", JSON.stringify(data));
}

// Save income to localStorage
function saveIncome(date, income) {
    const data = getStoredDataForDate(date, 'incomes') || [];
    data.push(income);
    localStorage.setItem(LOCAL_STORAGE_KEY + "-" + date + "-incomes", JSON.stringify(data));
}

// Retrieve stored data for a specific date (liabilities or incomes)
function getStoredDataForDate(date, key) {
    const storedData = localStorage.getItem(LOCAL_STORAGE_KEY + "-" + date + "-" + key);
    return storedData ? JSON.parse(storedData) : [];
}

// Render liabilities
// Render liabilities
function renderLiabilities(date) {
    ['expenses', 'debtors', 'drawings', 'creditPayments'].forEach(type => {
        const container = document.getElementById(type);
        container.innerHTML = `<button onclick="addRevenueLiability('${type}')">+ Add</button><h3>${type.charAt(0).toUpperCase() + type.slice(1)}</h3>`;
        
        const liabilities = getStoredDataForDate(date, 'liabilities').filter(l => l.type === type);
        liabilities.forEach((l, index) => {
            const li = document.createElement('div');
            li.innerText = `${l.name}: K${l.amount.toFixed(2)}`;

            li.dataset.index = index;  // Store index for deletion reference
            li.ondblclick = function() {
                if (confirm(`Do you want to delete the liability: ${l.name}?`)) {
                    deleteLiability(date, type, index);  // Call delete function
                }
            };
            container.appendChild(li);
        });
    });
}

// Render incomes
function renderIncomes(date) {
    ['credit', 'ownersDeposit', 'debtorPayments'].forEach(type => {
        const container = document.getElementById(type);
        container.innerHTML = `<button onclick="addIncome('${type}')">+ Add</button><h3>${type.charAt(0).toUpperCase() + type.slice(1)}</h3>`;
        
        const incomes = getStoredDataForDate(date, 'incomes').filter(i => i.type === type);
        incomes.forEach((i, index) => {
            const li = document.createElement('div');
            li.innerText = `${i.name}: K${i.amount.toFixed(2)}`;
            li.dataset.index = index;  // Store index for deletion reference
            li.ondblclick = function() {
                if (confirm(`Do you want to delete the income: ${i.name}?`)) {
                    deleteIncome(date, type, index);  // Call delete function
                }
            };
            container.appendChild(li);
        });
    });
}

// Function to delete liability
function deleteLiability(date, type, index) {
    const data = getStoredDataForDate(date, 'liabilities');
    data.splice(index, 1);  // Remove the liability from the array
    localStorage.setItem(LOCAL_STORAGE_KEY + "-" + date + "-liabilities", JSON.stringify(data));
    renderLiabilities(date);  // Re-render liabilities
    calculateTurnover();  // Update turnover
}

// Function to delete income
function deleteIncome(date, type, index) {
    const data = getStoredDataForDate(date, 'incomes');
    data.splice(index, 1);  // Remove the income from the array
    localStorage.setItem(LOCAL_STORAGE_KEY + "-" + date + "-incomes", JSON.stringify(data));
    renderIncomes(date);  // Re-render incomes
    calculateTurnover();  // Update turnover
}

// Calculate turnover and display
// Calculate turnover and display
function calculateTurnover() {
    const liabilities = getStoredDataForDate(currentDate, 'liabilities');
    const incomes = getStoredDataForDate(currentDate, 'incomes');

    const totalLiabilities = liabilities.reduce((sum, l) => sum + l.amount, 0);
    const totalIncomes = incomes.reduce((sum, i) => sum + i.amount, 0);

    const netSales = parseFloat(document.getElementById('totalAmount').innerText.replace('K', '')) || 0;
    const netPurchases = Array.from(document.querySelectorAll('#statisticsTable tbody tr')).reduce((sum, row) => {
        const orders = parseFloat(row.cells[2].innerText) || 0;
        const price = parseFloat(row.cells[6].innerText) || 0;
        return sum + (orders * price);
    }, 0);

    const grossProfit = netSales + totalIncomes;
    const netProfit = grossProfit - totalLiabilities;

    document.getElementById('totalRevenueLiabilities').innerText = `K${totalLiabilities.toFixed(2)}`;
    document.getElementById('totalIncomes').innerText = `K${totalIncomes.toFixed(2)}`;
    document.getElementById('netSales').innerText = `K${netSales.toFixed(2)}`;
    document.getElementById('netPurchases').innerText = `K${netPurchases.toFixed(2)}`;
    document.getElementById('grossProfit').innerText = `K${grossProfit.toFixed(2)}`;
    document.getElementById('netProfit').innerText = `K${netProfit.toFixed(2)}`;
}

// Update turnover calculations
function updateTurnover() {
    const liabilities = getStoredDataForDate(currentDate, 'liabilities');
    const incomes = getStoredDataForDate(currentDate, 'incomes');
    calculateTurnover();
}
// Function to share the table via WhatsApp
function searchItem() {
    const input = document.getElementById("searchInput").value.toLowerCase();
    const rows = document.getElementById('statisticsTable').getElementsByTagName('tbody')[0].rows;

    for (let i = 0; i < rows.length; i++) {
        const itemCell = rows[i].cells[0];
        const itemName = itemCell.innerText.toLowerCase();

        // Remove highlight if the search input is empty or does not match
        if (input === "" || !itemName.includes(input)) {
            rows[i].classList.remove('highlight');
        } 
        // Highlight if the item name matches the input
        else if (itemName.includes(input)) {
            rows[i].classList.add('highlight');
        }
    }
}

</script>

</body>

</html>
